# fileStorage

Для запуска сервера, клиента и всего необходимого окружения необходимо использовать Makefile.

В Makefile есть три цели:
- make all - запуск run_server
- make run_server - запуск сервера и окружения. Окружение запускается с фоновом режиме
- make run_client - запуск клиента

При необходимости можно запустить сервер и клиент вручную, последовательно введя команды целей из корневой папки проекта

## Сервер

Сервер fileStorage позволяет клиенту хранить файлы, получать список файлов и загружать ранее сохраненные на сервере файлы.
На сервере ведется логирование всех операций и ошибок с информацией о пользователе сервера.
Для работы с сервером клиенту необходимо авторизоваться или зарегистрироваться.
Данные о пользователях хранятся в релеционной базе данных PostgreSQL. 


### PostgreSQL.

При запуске сервера, автоматически запускается релеционная база данных PostgreSQL в Docker. 
Dockerfile распологается в ./cmd/server/database/ 

Настройка запуска базы реальзована в файле docker-compose.yaml. 
Все параметры для реализации базы данных можно поменять в этом файле. При изменении параметров, необходимо аналогично поменять значения параметров в файле конфигурации подключения сервера к базе данных, расположенного в 
./cmd/server/database/config.yaml

В базе данных хранятся логин и пароль пользователей. Поле логин является primary-key, что не позволяет создавать двух пользователей с одним логином.


### Конфигурация сервера

Файл конфигурации сервера находится в файле ./config/server_congif.yaml.

В файле 2 параметра:
- address: адрес, по которому работает сервер
- maxByteSend: максимальное количество байт файла, которое может передаваться за один пакет  

При запуске сервера и клиента, конфигурация автоматически считывается с файла, тем самым можно легко поменять стартовые параметры работы сервера.


### API:

Сервер fileStorage реализован на gRPC API. 
Запросы и ответы описаны в файле ./proto/fileStorage.proto

Всего реализовано 5 пар запрос-ответ:
- LogIn - вход на сервер
- Reg - регистрация на сервере
- GetFiles - запрос списка файлов, хранящихся на сервере
- PostFile - загрузка файла на сервер
- GetFile - сохранение файла с сервера

Сохраненные файлы находятся в папке ./cmd/server/serverStorage/
Сохранять и загружать можно любые файлы. При загрузке больших файлов, файлы загружаются пакетами, размер которых устанвливаются в настройке maxByteSend.

Остановить сервер можно сочетанием клавиш CRRL+C. После этого будет произведен Graceful Shutdown сервера c завершением всех запущенных goroutine.


## Клиент

Клиент реализован как CLI, посредством которого можно взаимодействовать с сервером.

При запуске клиента, он автоматически подгружает необходимую конфигурацию сервера с файла ./config/server_congif.yaml.

После запуска клиента необходимо авторизоваться на сервере, после чего можно начать работу с сервером. 

Сервер fileStorage позволяет загружать файлы с сервера и сохранять файлы на сервер.
Файлы сохранятся в папку ./cmd/client/download/
При загрузке файла на сервер, необходимо указывать полный путь файла, который необходимо загрузить. 


Желаем Вам приятной работы с клиентом и сервером fileStorage. 